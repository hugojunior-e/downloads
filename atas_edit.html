<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ata de Reunião</title>
    <link rel="stylesheet" href="estilos.css">
    <script src="api.js"></script> 

    <script>
        const queryString = window.location.search;
        const params = new URLSearchParams(queryString);

        global_id = '-';

        const obterDataAtual = () => {
          const data = new Date();
          const dia = String(data.getDate()).padStart(2, '0'); // Garantir dois dígitos
          const mes = String(data.getMonth() + 1).padStart(2, '0'); // Meses começam em 0
          const ano = data.getFullYear();
          return `${dia}/${mes}/${ano}`;
        };   


        function populateTable(data) {
            document.all.dt_inicio.value = obterDataAtual();
            document.getElementById('numero').readOnly = false;
            
            data['results'].forEach(item => {
                document.all.numero.value = item.numero;
                document.all.dt_inicio.value = item.dt_inicio;
                document.all.hr_inicio.value = item.hr_inicio;
                document.all.hr_fim.value = item.hr_fim;
                document.all.dt_convocacao.value = item.dt_convocacao;
                document.all.secretario.value = item.secretario;
                document.all.endereco.value = item.endereco;
                document.all.presidente.value = item.presidente;
                document.all.participantes.value = item.participantes;
                document.all.atv_inicial.value = item.atv_inicial;
                document.all.atv_final.value = item.atv_final;
                document.all.assuntos.value = item.assuntos;

                global_id = item.objectId;
                document.getElementById('numero').readOnly = true;
            });
        }

        function getData() {
            data = {
                "sociedade":"CONSELHO",
                "numero":document.all.numero.value,
                "dt_inicio":document.all.dt_inicio.value,
                "hr_inicio":document.all.hr_inicio.value,
                "hr_fim":document.all.hr_fim.value,
                "dt_convocacao":document.all.dt_convocacao.value,
                "secretario":document.all.secretario.value,
                "endereco":document.all.endereco.value,
                "presidente":document.all.presidente.value,
                "participantes":document.all.participantes.value,
                "atv_inicial":document.all.atv_inicial.value,
                "atv_final":document.all.atv_final.value,
                "assuntos":document.all.assuntos.value
            };
            
            return data;
        }

        function jsSalvar() {
            if ( global_id !== "-" ) {
                document.getElementById('numero').readOnly = true;
                apiQueryUpdate( url_atas, global_id, getData(), function() {
                    alert("Atualizado com sucesso!")
                });
            } else {
                document.getElementById('numero').readOnly = false;
                apiQueryInsert( url_atas, getData(), function(a) { 
                    global_id = a; 
                    alert("Inserido com sucesso!")
                });
            }
        }
    </script>


</head>
<body>
    <div class="container">
        <h1>Ata de Reunião</h1>
        <form>
            <div class="form-group">
                <label for="numero-ata">Número da Ata:(nro/ano)</label>
                <input type="text" id="numero" name="numero" placeholder="Ex: oito" required>
            </div>

            <div class="form-group">
                <label for="data-reuniao">Data da Reunião:</label>
                <input type="text" id="dt_inicio" name="dt_inicio" placeholder="dd/mm/yyyy" required>
            </div>

            <div class="form-group">
                <label for="data-convocacao">Data da Convocação:</label>
                <input type="text" id="dt_convocacao" name="dt_convocacao" placeholder="dd/mm/yyyy"  required>
            </div>

            <div class="form-group">
                <label for="endereco">Endereço:</label>
                <input type="text" id="endereco" name="endereco" placeholder="Rua, número, bairro, cidade" value="em seu templo, situado à Rua Paraná, número 1333, no Bairro Brasil, no município de Uberlândia, MG" required>
            </div>

            <div class="form-group">
                <label for="presidente">Presidente da Reunião:</label>
                <input type="text"  id="presidente" name="presidente" placeholder="Nome completo">
            </div>

            <div class="form-group">
                <label for="participantes">Participantes:</label>
                <textarea id="participantes" name="participantes" placeholder="Insira os nomes dos participantes separados por vírgula." rows="5" required>
João Fernando Neves Martins, Lucas Ezer de Souza Marques, Hugo Antônio da Costa Júnior, Júlio Aparecido Gomes Santos, Carlos Roberto Gomes de Aguiar e o Reverendo Elieder Marques
                </textarea>
            </div>

            <div class="form-group">
                <label for="horario-inicio">Horário de Início:</label>
                <input type="text" id="hr_inicio" name="hr_inicio" placeholder="hh:mi" required>
            </div>
            <div class="form-group">
                <label for="atividades-iniciais">Atividades Iniciais:</label>
                <textarea id="atv_inicial" name="atv_inicial" placeholder="Descrição das atividades iniciais." rows="5" required></textarea>
            </div>
            <div class="form-group">
                <label for="assuntos-discutidos">Assuntos Discutidos:</label>
                <textarea id="assuntos" name="assuntos" placeholder="Descrição dos assuntos discutidos." rows="10" required></textarea>
            </div>
            <div class="form-group">
                <label for="atividades-encerramento">Atividades de Encerramento:</label>
                <textarea id="atv_final" name="atv_final" placeholder="Descrição das atividades de encerramento." rows="5" required></textarea>
            </div>
            <div class="form-group">
                <label for="horario-termino">Horário de Término:</label>
                <input type="text" id="hr_fim" name="hr_fim" placeholder="hh:mi" required>
            </div>
            <div class="form-group">
                <label for="secretario">Secretário Responsável:</label>
                <input type="text" id="secretario" name="secretario" placeholder="Nome completo" value="Hugo Antônio da Costa Júnior, primeiro secretário">
            </div>
            <center><button type="button" onclick="jsSalvar()">Salvar Ata</button></center>
        </form>
    </div>

    <script> 
        parametros = { sociedade: "CONSELHO", numero:params.get('nro') };
        apiQueryData(url_atas, populateTable, parametros); 
    </script>
</body>
</html>
