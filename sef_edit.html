<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEF</title>
    <link rel="stylesheet" href="estilos.css">
    <script src="api.js"></script>
    
    <script>
        queryString = window.location.search;
        params      = new URLSearchParams(queryString);
        objectId    = params.get("objectId");


        function getData() {
            informacoes = {
                "horario_inicio":document.all.horario_inicio.value,
                "horario_final":document.all.horario_final.value,
                "diacono": (document.all.diacono_sim.checked ? "sim" : "nao" ),
                "responsavel_abertura":document.all.responsavel_abertura.value,
                "quantidade_diacono": (document.all.diacono_1.checked ? "1" : "2" ),
                "recepcao": (document.all.recepcao_sim.checked ? "sim" : "nao" ),
                "sonoplastia": (document.all.sonoplastia_sim.checked ? "sim" : "nao" ) ,
                "sonoplastia_detalhes":document.all.sonoplastia_detalhes.value,
                "datashow":document.all.datashow.checked,
                "televisao":document.all.televisao.checked,
                "nave_templo":document.all.nave_templo.checked,
                "salao_social":document.all.salao_social.checked,
                "cozinha":document.all.cozinha.checked,
                "quadra":document.all.quadra.checked,
                "casa_pastoral":document.all.casa_pastoral.checked,
                "salas_ebd":document.all.salas_ebd.checked
            };
            
            data = {
                "criado_em":document.all.data_programacao.value,
                "criado_por":document.all.responsavel_programacao.value,
                "titulo":document.all.programacao.value,
                "informacoes": JSON.stringify( informacoes ),
                "status":"PENDENTE"
            };
            return data;
        }

        function jsSalvar() {
            if ( objectId !== "-" ) {
                apiQueryUpdate( url_doc_sef, objectId, getData(), function(cod, msg) {
                    alert("Atualizado: " + msg)
                });
            } else {
                apiQueryInsert( url_doc_sef , getData(), function(cod, msg) { 
                    if (cod == 0) {
                        objectId = msg; 
                    }
                    alert("Inserido: " + msg)
                });
            }
        }

        function populateTable(data) {
            data['results'].forEach(item => {
                document.all.programacao.value = item.titulo;
                document.all.data_programacao.value = item.criado_em;
                document.all.responsavel_programacao.value = item.criado_por;

                infos = JSON.parse( item.informacoes );

                document.all.horario_inicio.value = infos.horario_inicio;
                document.all.horario_final.value = infos.horario_final;
                
                document.all.diacono_sim.checked = infos.diacono == "sim";
                document.all.diacono_nao.checked = infos.diacono == "nao";
                document.all.diacono_1.checked = infos.quantidade_diacono == "1";
                document.all.diacono_2.checked = infos.quantidade_diacono == "2";

                document.all.responsavel_abertura.value = infos.responsavel_abertura;
                
                document.all.recepcao_sim.checked = infos.recepcao == "sim";
                document.all.recepcao_nao.checked = infos.recepcao == "nao";
                
                document.all.sonoplastia_sim.checked = infos.sonoplastia == "sim";
                document.all.sonoplastia_nao.checked = infos.sonoplastia == "nao";
                document.all.sonoplastia_detalhes.value = infos.sonoplastia_detalhes;

                objectId = item.objectId;
            });
        }        
        
    </script>
    
</head>
<body>
    <h1>S.E.F. - Solicitação de Espaço Físico</h1>
    <form>
        <div class="section">
            <label for="programacao">00) Titulo programação:</label>
            <input type="text" id="programacao" name="programacao">
        </div>
        
        <div class="section">
            <label for="data-programacao">01) Data da programação:</label>
            <input type="text" id="data_programacao" name="data_programacao">
        </div>

        <div class="section">
            <label>02) Horário:</label>
            <div class="inline">
                <label for="horario-inicio">Início:</label>
                <input type="time" id="horario_inicio" name="horario_inicio">
            </div>
            <div class="inline">
                <label for="horario-final">Final:</label>
                <input type="time" id="horario_final" name="horario_final">
            </div>
        </div>

        <div class="section">
            <label>03) Precisa de diácono?</label>
            <input type="radio" id="diacono_nao" name="diacono" value="nao">Não
            <input type="radio" id="diacono_sim" name="diacono" value="sim">Sim

            <div>
                <label for="responsavel-abertura">Responsável por abrir a igreja:</label>
                <input type="text" id="responsavel_abertura" name="responsavel_abertura">
            </div>

            <div>
                <label>Quantos?</label>
                <input type="radio" id="diacono_1" name="quantidade_diacono" value="1">1
                <input type="radio" id="diacono_2" name="quantidade_diacono" value="2">2
            </div>
        </div>

        <div class="section">
            <label>04) Precisa de apoio do Ministério de Recepção?</label>
            <input type="radio" id="recepcao_sim" name="recepcao" value="sim">Sim
            <input type="radio" id="recepcao_nao" name="recepcao" value="nao">Não
        </div>

        <div class="section">
            <label>05) Precisa de sonoplastia?</label>
            <input type="radio" id="sonoplastia_sim" name="sonoplastia" value="sim">Sim
            <input type="radio" id="sonoplastia_nao" name="sonoplastia" value="nao">Não

            <textarea name="sonoplastia_detalhes" placeholder="Descreva resumidamente: quantos microfones? Grupo musical? Etc."></textarea>
        </div>

        <div class="section">
            <label>06) Utilizará equipamento de mídia?</label>
            <input type="checkbox" id="datashow" name="midia" value="datashow">Datashow
            <input type="checkbox" id="televisao" name="midia" value="televisao">Televisao
        </div>

        <div class="section">
            <label>07) Quais setores da estrutura da igreja serão utilizados:</label>
            <div>
                <input type="checkbox" id="nave_templo" name="setores" value="nave">Nave do Templo<br>
                <input type="checkbox" id="salao_social" name="setores" value="salao">Salão Social<br>
                <input type="checkbox" id="cozinha" name="setores" value="cozinha">Cozinha<br>
                <input type="checkbox" id="quadra" name="setores" value="quadra">Quadra<br>
                <input type="checkbox" id="casa_pastoral" name="setores" value="casa-pastoral">Casa Pastoral<br>
                <input type="checkbox" id="salas_ebd" name="setores" value="salas-ebd">Salas EBD
            </div>
        </div>

        <div class="section">
            <label for="responsavel-programacao">08) Responsável pela programação:</label>
            <input type="text" id="responsavel_programacao" name="responsavel_programacao">
        </div>
        <hr>
        <div class="instructions">
            <strong>Orientações:</strong>
            <ul>
                <li>Ao término da programação, verifique:</li>
                <li>Se deixou o alarme armado;</li>
                <li>Apagou todas as luzes e não deixou nenhuma torneira aberta;</li>
                <li>Nenhuma porta de acesso externo aberta;</li>
                <li>Fechou válvula do botijão de gás;</li>
                <li>Mantenha a igreja limpa e organizada.</li>
            </ul>
            <p><em>"Alegrei-me quando me disseram: Vamos à Casa do SENHOR" – Salmos 122:1</em></p>
        </div>

        <center><button onclick="jsSalvar()">Salvar SEF</button></center>
    </form>

    <script>
            parametros = { objectId: objectId };
            apiQueryData(url_doc_sef, populateTable, parametros); 
    </script>
</body>
</html>
