<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATAS de reunião</title>
    <link rel="stylesheet" href="estilos.css">
    <script src="api.js"></script>
    
    <script>
        const sociedade = "CONSELHO";
        
        const valores_default = {
            conselho: {
                participantes: "João Fernando Neves Martins, Lucas Ezer de Souza Marques, Hugo Antônio da Costa Júnior, Júlio Aparecido Gomes Santos, Carlos Roberto Gomes de Aguiar e o Reverendo Elieder Marques"
            }
        };

        global_id = '-';

        function getData() {
            data = {
                "sociedade":sociedade,
                "numero":document.all.numero.value,
                "dt_inicio":document.all.dt_inicio.value,
                "hr_inicio":document.all.hr_inicio.value,
                "hr_fim":document.all.hr_fim.value,
                "dt_convocacao":document.all.dt_convocacao.value,
                "secretario":document.all.secretario.value,
                "endereco":document.all.endereco.value,
                "presidente":document.all.presidente.value,
                "participantes":document.all.participantes.value,
                "atv_inicial":document.all.atv_inicial.value,
                "atv_final":document.all.atv_final.value,
                "assuntos":document.all.assuntos.value
            };
            
            return data;
        }

        
        
        function populateTable(data) {
            obj_l = document.getElementById('LINK_ATAS');
            obj_l.innerHTML = '';

            items = []

            data['results'].forEach(item => {
                if (item.numero.length > 4) {
                    items.push( [item.numero, item.objectId] );
                }
            });
            items.sort((a, b) => a[0].localeCompare(b[0]));
            
            items.forEach(item => {
                clauseWhere      = "objectId=" + item[1];
                obj_l.innerHTML += "<table><tr><td><input type=image src=edit.png onclick=\"jsAddOrEdit('" + item[1] + "')\"></td><td><a href=atas_view.html?" + clauseWhere + ">" + item[0] + "</a></td></tr></table>";
            });
        }
        

        function jsAddOrEdit(nro) {
            global_id = nro;
            document.all.numero.readOnly          = false;
            document.all.formulario.style.display = '';
            document.all.listinha.style.display   = 'none';

            const inputs = document.all.formulario.querySelectorAll('input[type="text"]');

            inputs.forEach(input => {
                input.value = valores_default[sociedade][input.id] ;
            });
            
            
            if ( nro !== "-" ) {
                formParam = { objectId: nro };
                apiQueryData(url_atas, function(data) {
                    document.all.dt_inicio.value = obterDataAtual();
                    document.all.numero.readOnly = true;
                    
                    data['results'].forEach(item => {
                        document.all.numero.value = item.numero;
                        document.all.dt_inicio.value = item.dt_inicio;
                        document.all.hr_inicio.value = item.hr_inicio;
                        document.all.hr_fim.value = item.hr_fim;
                        document.all.dt_convocacao.value = item.dt_convocacao;
                        document.all.secretario.value = item.secretario;
                        document.all.endereco.value = item.endereco;
                        document.all.presidente.value = item.presidente;
                        document.all.participantes.value = item.participantes;
                        document.all.atv_inicial.value = item.atv_inicial;
                        document.all.atv_final.value = item.atv_final;
                        document.all.assuntos.value = item.assuntos;
                    });                
                }, formParam); 
            }
        }


        function jsSalvar() {
            if ( global_id !== "-" ) {
                document.getElementById('numero').readOnly = true;
                apiQueryUpdate( url_atas, global_id, getData(), function() {
                    alert("Atualizado com sucesso!")
                });
            } else {
                document.getElementById('numero').readOnly = false;
                apiQueryInsert( url_atas, getData(), function(a) { 
                    global_id = a; 
                    alert("Inserido com sucesso!")
                });
            }
        }
        
        function jsVoltar() {
            document.all.formulario.style.display = 'none';
            document.all.listinha.style.display = '';
        }
        
    </script>

</head>

<body>
    <!-- LISTA DE ATAS PARA EXIBIR -->
    
    <div class="container" id=listinha>
    <center>
        <fieldset>
            <legend><input type="button" value="adicionar" onclick="jsAddOrEdit('-')"> || <span id=SOCIEDADE></span></legend>
            <div class="links" id="LINK_ATAS"></div>
        </fieldset>
    </center>
    </div>

    <!-- FORMULARIO DE EDICAO -->

    <div id=formulario style="display:none">

        <h1>Ata de Reunião</h1>
        <form id=formulario>
            <div class="form-group">
                <label for="numero-ata">Número da Ata:(nro/ano)</label>
                <input type="text" id="numero" name="numero" placeholder="Ex: oito" required>
            </div>

            <div class="form-group">
                <label for="data-reuniao">Data da Reunião:</label>
                <input type="text" id="dt_inicio" name="dt_inicio" placeholder="dd/mm/yyyy" required>
            </div>

            <div class="form-group">
                <label for="data-convocacao">Data da Convocação:</label>
                <input type="text" id="dt_convocacao" name="dt_convocacao" placeholder="dd/mm/yyyy"  required>
            </div>

            <div class="form-group">
                <label for="endereco">Endereço:</label>
                <input type="text" id="endereco" name="endereco" placeholder="Rua, número, bairro, cidade" value="em seu templo, situado à Rua Paraná, número 1333, no Bairro Brasil, no município de Uberlândia, MG" required>
            </div>

            <div class="form-group">
                <label for="presidente">Presidente da Reunião:</label>
                <input type="text"  id="presidente" name="presidente" placeholder="Nome completo" value="Reverendo Joscelino dos Santos, presidente do conselho">
            </div>

            <div class="form-group">
                <label for="participantes">Participantes:</label>
                <textarea id="participantes" name="participantes" placeholder="Insira os nomes dos participantes separados por vírgula." rows="5" required>
                </textarea>
            </div>

            <div class="form-group">
                <label for="horario-inicio">Horário de Início:</label>
                <input type="text" id="hr_inicio" name="hr_inicio" placeholder="hh:mi" required>
            </div>
            <div class="form-group">
                <label for="atividades-iniciais">Atividades Iniciais:</label>
                <textarea id="atv_inicial" name="atv_inicial" placeholder="Descrição das atividades iniciais." rows="5" required></textarea>
            </div>
            <div class="form-group">
                <label for="assuntos-discutidos">Assuntos Discutidos:</label>
                <textarea id="assuntos" name="assuntos" placeholder="Descrição dos assuntos discutidos." rows="10" required></textarea>
            </div>
            <div class="form-group">
                <label for="atividades-encerramento">Atividades de Encerramento:</label>
                <textarea id="atv_final" name="atv_final" placeholder="Descrição das atividades de encerramento." rows="5" required></textarea>
            </div>
            <div class="form-group">
                <label for="horario-termino">Horário de Término:</label>
                <input type="text" id="hr_fim" name="hr_fim" placeholder="hh:mi" required>
            </div>
            <div class="form-group">
                <label for="secretario">Secretário Responsável:</label>
                <input type="text" id="secretario" name="secretario" placeholder="Nome completo" value="Hugo Antônio da Costa Júnior, primeiro secretário">
            </div>
            <center><button type="button" onclick="jsSalvar()">Salvar Ata</button> <button type="button" onclick="jsVoltar()">Voltar</button>   </center>

        </form>

    </div>
    

    <script> 
        document.all.SOCIEDADE.innerHTML = sociedade;
        parametros = { sociedade: sociedade };
        apiQueryData( url_atas, populateTable, parametros ); 
    </script>
</body>

</html>
